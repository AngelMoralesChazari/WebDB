<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Pelis - UAGRO | Pel√≠culas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
<header class="site-header">
    <div class="logo-area">
        <span class="logo-icon">ü¶Ö</span>
        <span class="logo-text">Pelis - UAGRO</span>
    </div>

    <nav class="main-nav">
        <a href="{{ url_for('home') }}" class="nav-link">Inicio</a>
        <a href="{{ url_for('peliculas') }}" class="nav-link active">Pel√≠culas</a>
        <a href="{{ url_for('series') }}" class="nav-link">Series</a>
        <a href="{{ url_for('cuenta') }}" class="nav-link">Mi cuenta</a>
    </nav>

    <div class="user-area">
        {% if session.get('usuario_nombre') %}
            {% set primer_nombre = session['usuario_nombre'].split(' ')[0] %}
            <div class="user-menu">
                <button class="btn-login user-menu-toggle">
                    {{ primer_nombre }}
                </button>
                <div class="user-menu-dropdown">
                    <a href="{{ url_for('cuenta') }}">Configuraci√≥n</a>
                    <a href="{{ url_for('logout') }}">Cerrar sesi√≥n</a>
                </div>
            </div>
        {% else %}
            <a href="{{ url_for('login') }}" class="btn-login">Iniciar sesi√≥n</a>
        {% endif %}
    </div>
</header>

<main class="main-content peliculas-page">
    <section class="row" style="margin-top: 20px;">
        <div class="row-header">
            <h2 class="row-title">Cat√°logo completo</h2>
            <p class="row-subtitle">Explora las pel√≠culas disponibles en la plataforma.</p>
        </div>

        {% if peliculas %}
        <div class="movies-grid">
            {% for peli in peliculas %}
            <a href="{{ url_for('detalle_pelicula', movie_id=peli.id) }}" class="movie-card-link">
                <article class="movie-card-grid">
                    <div class="movie-poster-wrapper">
                        <div class="movie-poster"
                             style="
                             {% if peli.poster %}
                                 background-image: url('{{ peli.poster }}');
                             {% endif %}
                             ">
                        </div>
                        <div class="movie-rating-badge">
                            ‚≠ê {{ peli.promedio|round(1) }}/10
                        </div>
                    </div>
                    <div class="movie-info">
                        <h3 class="movie-title">{{ peli.titulo }}</h3>
                        <p class="movie-meta">
                            {{ peli.genero }} ‚Ä¢ {{ peli.fecha }}<br>
                            <span class="movie-votes">{{ peli.votos }} votos</span>
                        </p>
                    </div>
                </article>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <p>No hay pel√≠culas para mostrar.</p>
        {% endif %}
    </section>
</main>

<script>
    // Dropdown usuario
    document.addEventListener('click', function (e) {
        const toggle = document.querySelector('.user-menu-toggle');
        const dropdown = document.querySelector('.user-menu-dropdown');

        if (!toggle || !dropdown) return;

        if (toggle.contains(e.target)) {
            const isVisible = dropdown.style.display === 'block';
            dropdown.style.display = isVisible ? 'none' : 'block';
        } else if (!dropdown.contains(e.target)) {
            dropdown.style.display = 'none';
        }
    });
</script>
</body>
</html>