<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Pelis - UAGRO</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
    <header class="site-header">
        <div class="logo-area">
            <span class="logo-icon">ü¶Ö</span>
            <span class="logo-text">Pelis - UAGRO</span>
        </div>

        <nav class="main-nav">
            <a href="{{ url_for('home') }}" class="nav-link active">Inicio</a>
            <a href="{{ url_for('peliculas') }}" class="nav-link">Pel√≠culas</a>
            <a href="{{ url_for('cuenta') }}" class="nav-link">Mi cuenta</a>
        </nav>

        <div class="user-area">
            {% if session.get('usuario_nombre') %}
            {% set primer_nombre = session['usuario_nombre'].split(' ')[0] %}
            <div class="user-menu">
                <button class="btn-login user-menu-toggle">
                    {{ primer_nombre }}
                </button>
                <div class="user-menu-dropdown">
                    <a href="{{ url_for('cuenta') }}">Configuraci√≥n</a>
                    <a href="{{ url_for('logout') }}">Cerrar sesi√≥n</a>
                </div>
            </div>
            {% else %}
            <a href="{{ url_for('login') }}" class="btn-login">Iniciar sesi√≥n</a>
            {% endif %}
        </div>
    </header>

    <main class="main-content">
        <section class="hero" {% if destacada and destacada.poster %} style="
            background-image:
            linear-gradient(to right, rgba(2,6,23,0.95), rgba(2,6,23,0.6), transparent),
            url('{{ destacada.poster }}');
            background-size: cover;
            background-position: center top;
            " {% endif %}>
            <div class="hero-overlay"></div>
            <div class="hero-content">
                {% if destacada %}
                <h1 class="hero-title">{{ destacada.titulo }}</h1>
                <p class="hero-description">
                    <strong>{{ destacada.genero }}</strong> ‚Ä¢ {{ destacada.fecha }}<br>
                    ‚≠ê {{ destacada.promedio|round(1) }}/10 ({{ destacada.votos }} votos)<br><br>
                    {{ destacada.overview[:200] }}{% if destacada.overview|length > 200 %}...{% endif %}
                </p>
                <div class="hero-buttons">
                    <button class="btn-primary">‚ñ∂ Reproducir</button>
                    <button class="btn-secondary">‚Ñπ M√°s informaci√≥n</button>
                </div>
                {% else %}
                <h1 class="hero-title">Pel√≠cula Destacada</h1>
                <p class="hero-description">
                    No se pudo cargar la pel√≠cula destacada.
                </p>
                {% endif %}
            </div>
        </section>

        <section class="row">
            <h2 class="row-title">Tendencias</h2>
            <div class="carousel-container">
                <button class="carousel-btn carousel-btn-left" onclick="scrollCarousel('tendencias', 'left')">‚Äπ</button>

                <div class="carousel-wrapper" id="carouselTendencias">
                    {% for peli in tendencias %}
                    <a href="{{ url_for('detalle_pelicula', movie_id=peli.id) }}" class="movie-link">
                        <article class="movie-card-carousel">
                            <div class="movie-cover" style="
                                {% if peli.poster %}
                                background-image: url('{{ peli.poster }}');
                                background-size: cover;
                                background-position: center;
                                {% endif %}
                                ">
                            </div>
                            <h3 class="movie-title">{{ peli.titulo }}</h3>
                            <p class="movie-meta">
                                {{ peli.genero }} ‚Ä¢ {{ peli.fecha }}<br>
                                ‚≠ê {{ peli.promedio|round(1) }}/10
                            </p>
                        </article>
                    </a>
                    {% endfor %}
                </div>

                <button class="carousel-btn carousel-btn-right"
                    onclick="scrollCarousel('tendencias', 'right')">‚Ä∫</button>
            </div>
        </section>

        <section class="row">
            <h2 class="row-title">Recomendadas para ti</h2>
            <div class="carousel-container">
                <button class="carousel-btn carousel-btn-left"
                    onclick="scrollCarousel('recomendadas', 'left')">‚Äπ</button>

                <div class="carousel-wrapper" id="carouselRecomendadas">
                    {% for peli in recomendadas %}
                    <a href="{{ url_for('detalle_pelicula', movie_id=peli.id) }}" class="movie-link">
                        <article class="movie-card-carousel">
                            <div class="movie-cover" style="
                                {% if peli.poster %}
                                background-image: url('{{ peli.poster }}');
                                background-size: cover;
                                background-position: center;
                                {% endif %}
                                ">
                            </div>
                            <h3 class="movie-title">{{ peli.titulo }}</h3>
                            <p class="movie-meta">
                                {{ peli.genero }} ‚Ä¢ {{ peli.fecha }}<br>
                                ‚≠ê {{ peli.promedio|round(1) }}/10
                            </p>
                        </article>
                    </a>
                    {% endfor %}
                </div>

                <button class="carousel-btn carousel-btn-right"
                    onclick="scrollCarousel('recomendadas', 'right')">‚Ä∫</button>
            </div>
        </section>
    </main>

    <script>
        function scrollCarousel(nombre, direction) {
            let id = '';
            if (nombre === 'tendencias') {
                id = 'carouselTendencias';
            } else if (nombre === 'recomendadas') {
                id = 'carouselRecomendadas';
            } else {
                return;
            }

            const carousel = document.getElementById(id);
            const scrollAmount = 400; // p√≠xeles a desplazar

            if (direction === 'left') {
                carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
            } else {
                carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' });
            }
        }

        // === Men√∫ de usuario (dropdown) ===
        document.addEventListener('click', function (e) {
            const toggle = document.querySelector('.user-menu-toggle');
            const dropdown = document.querySelector('.user-menu-dropdown');

            if (!toggle || !dropdown) return;

            if (toggle.contains(e.target)) {
                // Click en el bot√≥n: alternar visibilidad
                const isVisible = dropdown.style.display === 'block';
                dropdown.style.display = isVisible ? 'none' : 'block';
            } else if (!dropdown.contains(e.target)) {
                // Click fuera del men√∫: cerrarlo
                dropdown.style.display = 'none';
            }
        });
    </script>
</body>

</html>