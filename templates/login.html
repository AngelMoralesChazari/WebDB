<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Iniciar sesi贸n | Pelis - UAGRO</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body class="login-body">
    <header class="site-header">
        <div class="logo-area">
            <span class="logo-icon"></span>
            <span class="logo-text">Pelis - UAGRO</span>
        </div>

        <nav class="main-nav">
            <a href="{{ url_for('home') }}" class="nav-link">Inicio</a>
            <a href="{{ url_for('peliculas') }}" class="nav-link">Pel铆culas</a>
            <a href="{{ url_for('series') }}" class="nav-link">Series</a>
            <a href="{{ url_for('cuenta') }}" class="nav-link">Mi cuenta</a>
        </nav>

        <div class="user-area">
            {% if session.get('usuario_nombre') %}
            {% set primer_nombre = session['usuario_nombre'].split(' ')[0] %}
            <div class="user-menu">
                <button class="btn-login user-menu-toggle">
                    {{ primer_nombre }}
                </button>
                <div class="user-menu-dropdown">
                    <a href="{{ url_for('cuenta') }}">Configuraci贸n</a>
                    <a href="{{ url_for('logout') }}">Cerrar sesi贸n</a>
                </div>
            </div>
            {% else %}
            <a href="{{ url_for('login') }}" class="btn-login">Iniciar sesi贸n</a>
            {% endif %}
        </div>
    </header>

    <main class="main-content login-page">
        <section class="login-panel">
            <div class="login-panel-inner">
                <h1 class="login-title">Iniciar Sesi贸n</h1>
                <p class="login-subtitle">Inicia sesi贸n para seguir viendo tus pel铆culas.</p>

                {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                <ul class="flashes">
                    {% for category, message in messages %}
                    <li class="flash-{{ category }}">{{ message }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                {% endwith %}

                <div class="login-forms">
                    <!-- Formulario de login -->
                    <form method="post" action="{{ url_for('login_post') }}" class="card-form">
                        <h2 class="card-title">Iniciar sesi贸n</h2>

                        <label class="form-field">
                            <span>Correo electr贸nico</span>
                            <input type="email" name="email" required>
                        </label>

                        <label class="form-field">
                            <span>Contrase帽a</span>
                            <input type="password" name="password" required>
                        </label>

                        <button type="submit" class="btn-primary btn-full">Entrar</button>
                    </form>

                    <!-- Formulario de registro -->
                    <form method="post" action="{{ url_for('registro') }}" class="card-form secondary-card">
                        <h2 class="card-title">驴Nuevo aqu铆?</h2>
                        <p class="card-text">Crea una cuenta para comenzar a disfrutar del cat谩logo.</p>

                        <label class="form-field">
                            <span>Nombre</span>
                            <input type="text" name="nombre" required>
                        </label>

                        <label class="form-field">
                            <span>Correo electr贸nico</span>
                            <input type="email" name="email" required>
                        </label>

                        <label class="form-field">
                            <span>Contrase帽a</span>
                            <input type="password" name="password" required>
                        </label>

                        <button type="submit" class="btn-secondary btn-full">Crear cuenta</button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('click', function (e) {
            const toggle = document.querySelector('.user-menu-toggle');
            const dropdown = document.querySelector('.user-menu-dropdown');

            if (!toggle || !dropdown) return;

            if (toggle.contains(e.target)) {
                const isVisible = dropdown.style.display === 'block';
                dropdown.style.display = isVisible ? 'none' : 'block';
            } else if (!dropdown.contains(e.target)) {
                dropdown.style.display = 'none';
            }
        });
    </script>
</body>

</html>