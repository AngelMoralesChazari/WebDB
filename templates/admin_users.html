<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Admin - Usuarios</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <style>
    /* Estilos espec√≠ficos para panel de administraci√≥n */
    .admin-container {
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #e74c3c;
    }
    
    .admin-title {
      color: #16e3fe;
      font-size: 2rem;
      font-weight: 700;
    }
    
    .admin-stats {
      background: #f8f9fa;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 2rem;
      display: flex;
      gap: 2rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .stat-item {
      text-align: center;
    }
    
    .stat-number {
      font-size: 1.8rem;
      font-weight: bold;
      color: #e74c3c;
    }
    
    .stat-label {
      font-size: 0.9rem;
      color: #7f8c8d;
    }
    
    .admin-table-container {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .admin-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .admin-table thead {
      background: linear-gradient(135deg, #2c3e50, #34495e);
      color: white;
    }
    
    .admin-table th {
      padding: 1rem;
      text-align: left;
      font-weight: 600;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .admin-table td {
      padding: 1rem;
      border-bottom: 1px solid #ecf0f1;
    }
    
    .admin-table tbody tr {
      transition: all 0.3s ease;
    }
    
    .admin-table tbody tr:hover {
      background: #f8f9fa;
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .admin-table tbody tr:nth-child(even) {
      background: #f8f9fa;
    }
    
    .admin-table tbody tr:nth-child(even):hover {
      background: #e8f4f8;
    }
    
    .user-email {
      color: #3498db;
      font-weight: 500;
    }
    
    .user-id {
      font-family: 'Courier New', monospace;
      background: #f1f2f6;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-weight: bold;
      color: #2c3e50;
    }
    
    .user-date {
      color: #8a8d7f;
      font-size: 0.9rem;
    }
    
    .action-buttons {
      display: flex;
      gap: 0.5rem;
    }
    
    .btn-danger-admin {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      font-size: 0.85rem;
    }
    
    .btn-danger-admin:hover {
      background: linear-gradient(135deg, #c0392b, #a93226);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);
    }
    
    .btn-view {
      background: linear-gradient(135deg, #3498db, #2980b9);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      font-size: 0.85rem;
      text-decoration: none;
      display: inline-block;
    }
    
    .btn-view:hover {
      background: linear-gradient(135deg, #2980b9, #1f618d);
      transform: translateY(-2px);
    }
    
    .admin-alert {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .admin-alert-icon {
      font-size: 1.5rem;
    }
    
    .no-users {
      text-align: center;
      padding: 3rem;
      color: #7f8c8d;
    }
    
    .no-users-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .admin-table-container {
        overflow-x: auto;
      }
      
      .admin-table {
        min-width: 800px;
      }
      
      .admin-stats {
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="logo-area">
      <span class="logo-icon">ü¶Ö</span>
      <span class="logo-text">Pelis - UAGRO</span>
    </div>
    <nav class="main-nav">
      <a href="{{ url_for('home') }}" class="nav-link">Inicio</a>
      <a href="{{ url_for('peliculas') }}" class="nav-link">Pel√≠culas</a>
      <a href="{{ url_for('cuenta') }}" class="nav-link">Mi cuenta</a>
    </nav>
  </header>

  <main class="admin-container">
    <div class="admin-header">
      <h1 class="admin-title">üëë Panel de Administraci√≥n</h1>
      <div class="user-info">
        <span>Administrador: <strong>{{ session.get('usuario_nombre', 'Admin') }}</strong></span>
      </div>
    </div>
    
    <div class="admin-stats">
      <div class="stat-item">
        <div class="stat-number">Hoy</div>
        <div class="stat-label">{{ now.strftime('%d/%m/%Y') if now else '' }}</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">{{ usuarios|length }}</div>
        <div class="stat-label">Usuarios Registrados</div>
      </div>
      
    </div>
    
    <div class="admin-table-container">
      {% if usuarios %}
      <table class="admin-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Usuario</th>
            <th>Email</th>
            <th>Fecha Registro</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
        {% for u in usuarios %}
          <tr>
            <td><span class="user-id">#{{ u.Usuario_ID }}</span></td>
            <td>
              <strong>{{ u.Nombre }}</strong>
              {% if u.Usuario_ID == 1 %}
              <span style="background: #e74c3c; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.7rem; margin-left: 5px;">Admin</span>
              {% endif %}
            </td>
            <td><span class="user-email">{{ u.Email }}</span></td>
            <td>
              <span class="user-date">{{ u.FechaRegistro.strftime('%d/%m/%Y') if u.FechaRegistro else 'N/A' }}</span><br>
              <small>{{ u.FechaRegistro.strftime('%H:%M') if u.FechaRegistro else '' }}</small>
            </td>
            <td>
              <div class="action-buttons">
                {% if u.Usuario_ID != 1 %}
                <form method="post" action="{{ url_for('admin_eliminar_usuario', usuario_id=u.Usuario_ID) }}" 
                      onsubmit="return confirm('¬øEliminar usuario {{ u.Email }}?\\n\\nEsto eliminar√°:\\n‚Ä¢ Todas sus rentas\\n‚Ä¢ Todas sus tarjetas\\n\\nLos datos se archivar√°n en el historial.');" 
                      style="display:inline;">
                  <button type="submit" class="btn-danger-admin">
                    üóëÔ∏è Eliminar
                  </button>
                </form>
                {% else %}
                <button class="btn-view" style="opacity: 0.6; cursor: not-allowed;" disabled>
                  üîí Protegido
                </button>
                {% endif %}
              </div>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      {% else %}
      <div class="no-users">
        <div class="no-users-icon">üë•</div>
        <h3>No hay usuarios registrados</h3>
        <p>No se han encontrado usuarios en el sistema.</p>
      </div>
      {% endif %}
    </div>
    
  </main>
  
  <script>
    // Agregar fecha actual si no est√° en el contexto
    if (!document.querySelector('.user-date').textContent.includes('/')) {
      const now = new Date();
      document.querySelectorAll('.stat-number')[2].textContent = now.toLocaleDateString('es-ES');
      document.querySelectorAll('.stat-label')[2].textContent = 'Fecha actual';
    }
    
    // Mejorar la confirmaci√≥n de eliminaci√≥n
    document.querySelectorAll('form[onsubmit]').forEach(form => {
      const originalOnsubmit = form.onsubmit;
      form.onsubmit = function(e) {
        const button = this.querySelector('button');
        if (button) {
          button.innerHTML = '‚è≥ Eliminando...';
          button.disabled = true;
          button.style.opacity = '0.7';
        }
        return originalOnsubmit.call(this, e);
      };
    });
    
    // Efecto hover mejorado
    document.querySelectorAll('.admin-table tbody tr').forEach(row => {
      row.addEventListener('mouseenter', function() {
        this.style.transition = 'all 0.3s ease';
      });
    });
  </script>
</body>
</html>